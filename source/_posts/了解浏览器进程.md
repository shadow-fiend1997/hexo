---
title: 了解浏览器进程
date: 2019-12-22 11:47:33
tags:
---

### 线程和进程
   #### 线程
 线程是什么呢？
  **进程是资源分配的最小单位，线程是CPU调度的最小单位。**

引用一下知乎上一个高赞的比喻 
- 线程在进程下行进（单纯的车厢无法运行）
- 一个进程可以包含多个线程（一辆火车可以有多个车厢）
- 不同进程间数据很难共享（一辆火车上的乘客很难换到另外一辆火车，比如站点换乘）
- 同一进程下不同线程间数据很易共享（A车厢换到B车厢很容易）
- 进程要比线程消耗更多的计算机资源（采用多列火车相比多个车厢更耗资源）
- 进程间不会相互影响，一个线程挂掉将导致整个进程挂掉（一列火车不会影响到另外一列火车，但是如果一列火车上中间的一节车厢着火了，将影响到所有车厢）
- 进程可以拓展到多机，进程最多适合多核（不同火车可以开在多个轨道上，同一火车的车厢不能在行进的不同的轨道上）

举一个实际的例子 
  
```
A = 2+3
B = 6/2
C = 2*3
D = A+B+C
```

我们要算出D 必须先得到 A、B、C的值。
如果是单线程运算 那就需要四步： 
1. 运算出A的值
2. 运算出B的值
3. 运算出C的值
4. A+B+C

如果是多个线程参与运算那只需要两步：
1. 用三个线程分别运算出A、B、C
2. A+B+1. 运算出A的值

多个线程可以并行处理任务，使用并行处理能大大提升性能。但是线程是不能单独存在的，它是由进程来启动和管理的。接下来看看啥是进程

 #### 进程
   **一个进程就是一个程序的运行实例。**
   详细的解释就是，当我们启动一个程序的时候，操作系统会为该程序创建一块内存，用来存放代码、运行中的数据和一个执行任务的主线程，我们把这样的一个运行环境叫**进程**。
   线程是依附于进程的，而进程中使用多线程并行处理能提升运算效率。 
   
   结合上面那个火车和车厢的例子我们再详细的分析一下几个值得注意的点:

  **1.线程之间共享进程中的数据。**
  因为一个进程会有被操作系统划分一块单独的内存，而一个进程中可以存在多个线程。 所以在这个进程中的线程可以共享数据。

 **2. 进程中的任意一线程执行出错，都会导致整个进程的崩溃。**
 因为线程是依托于进程运行的，所以只要任意一个线程出错，整个进程都会崩溃。

 **3. 当一个进程关闭之后，操作系统会回收进程所占用的内存。**
 当一个进程退出时，操作系统会回收该进程所申请的所有资源；即使其中任意线程因为操作不当导致内存泄漏，当进程退出时，这些内存也会被正确回收。   
  
**4. 进程之间的内容相互隔离。**
进程隔离是为保护操作系统中进程互不干扰的技术，每一个进程只能访问自己占有的数据，也就避免出现进程 A 写入数据到进程 B 的情况。正是因为进程之间的数据是严格隔离的，所以一个进程如果崩溃了，或者挂起了，是不会影响到其他进程的。

了解完线程和进程是什么之后，接下来进入正题，我们来看看先在浏览器中存在哪些进程

### chrome浏览器中的进程
   
最新的 Chrome 浏览器包括：1 个浏览器（Browser）主进程、1 个 GPU 进程、1 个网络（NetWork）进程、多个渲染进程和多个插件进程。

1. Browser进程：浏览器的主进程（负责协调、主控），只有一个。作用有负责浏览器界面显示，与用户交互。如前进，后退等负责各个页面的管理，创建和销毁其他进程将Renderer进程得到的内存中的Bitmap，绘制到用户界面上网络资源的管理，下载等。
2. GPU进程：最多一个，用于3D绘制等。
3. 网络进程。主要负责页面的网络资源加载。
4. 第三方插件进程：每种类型的插件对应一个进程，仅当使用该插件时才创建。
5. 浏览器渲染进程（浏览器内核）（Renderer进程，内部是多线程的）：默认每个Tab页面一个进程，互不影响。主要作用为页面渲染，脚本执行，事件处理等。


下面展开讲讲 渲染进程：

Chrome的默认策略是，每个标签对应一个渲染进程。但是如果从一个页面打开了新页面，而新页面和当前页面属于同一站点时，那么新页面会复用父页面的渲染进程。官方把这个默认策略叫process-per-site-instance。
直白的讲，就是如果几个页面符合同一站点，那么他们将被分配到一个渲染进程里面去。
所以，这种情况下，一个页面崩溃了，会导致同一站点的页面同时崩溃，因为他们使用了同一个渲染进程。

为什么要让他们跑在一个进程里面呢？
因为在一个渲染进程里面，他们就会共享JS的执行环境，也就是说A页面可以直接在B页面中执行脚本。因为是同一家的站点，所以是有这个需求的。

ps：相查看浏览器当前使用了几个进程 可以点击Chrome 浏览器右上角的“选项”菜单，选择“更多工具”子菜单，点击“任务管理器”，这将打开 Chrome 的任务管理器的窗口。